
<script src="<?= BASE_ASSET; ?>/js/jquery.hotkeys.js"></script>
<script type="text/javascript">
//This page is a result of an autogenerated content made by running test.html with firefox.
function domo(){
 
   // Binding keys
   $('*').bind('keydown', 'Ctrl+e', function assets() {
      $('#btn_edit').trigger('click');
       return false;
   });

   $('*').bind('keydown', 'Ctrl+x', function assets() {
      $('#btn_back').trigger('click');
       return false;
   });
    
}


jQuery(document).ready(domo);
</script>

<style>
	@media print {
		.th {
			width: 50%;
			padding: 0;
		}
	}

	body {

		margin: 3px;
	}

	body {}

	.td {
		height: 2px;
	}

	.invoice {
		padding: 5px;
		margin: 2px;
	}

	.table>tbody>tr>td,
	.table>tbody>tr>th,
	.table>tfoot>tr>td,
	.table>tfoot>tr>th,
	.table>thead>tr>td,
	.table>thead>tr>th {
		padding: 1px;
		line-height: 1.42857143;
		vertical-align: top;
		border-top: 1px solid #ddd;
	}

	.watermark {
		position: absolute;
		color: grey;
		opacity: 0.27;
		font-size: 7em;
		width: 70%;
		top: 50%;
		text-align: center;
		z-index: 0;

	}
</style>
<!-- Content Header (Page header) -->
<section class="content-header  hidden-print">
   <h1>
      Factures Des Patients     
   </h1>
   <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
      <li class=""><a  href="<?= site_url('administrator/hospital_ibi_commandes'); ?>">Factures Des Patients</a></li>
      <li class="active"><?= cclang('detail'); ?></li>
   </ol>
</section>
<!-- Main content -->
<?php

$patient_file_id = $factures->PATIENT_FILE_ID_FACTURE;
   // get patient_file_info 
   $get_patient_file_info = $this->model_departements->getOne_data("patient_file","PATIENT_FILE_ID=".$factures->PATIENT_FILE_ID_FACTURE);
   $letter = $get_patient_file_info->LETTER;
   $ref_societe = $get_patient_file_info->REF_SOCIETE;
   $bon_commandes = $get_patient_file_info->BON_DE_COMMANDE;
   $department_id = $get_patient_file_info->DEPARTEMENT_ID;
   $doctor_id = $get_patient_file_info->DOCTOR_ID;

   $get_patient_info = $this->model_departements->getOne_data("patients","ID_PATIENT=".$get_patient_file_info->PATIENT_ID);

//  get somme_percue or caution

//GETTING CAUTION & SOMME PERCU
         $SOMME_PERCU = 0;
         $hospital_ibi_commandes_somme_percue = $this->model_hospital_ibi_commandes->get_commandes_info($patient_file_id);
         if ($hospital_ibi_commandes_somme_percue->num_rows() > 0) {
               foreach ($hospital_ibi_commandes_somme_percue->result() as $hospital_ibi_commandes_somme_percue) {
                     $SOMME_PERCU = $hospital_ibi_commandes_somme_percue->SOMME_PERCU;
                  }
			}
			
			$CAUTION = 0;
			 $factures_caution = $this->db->query("SELECT SUM(MONTANT_PAIEMENT) as montant FROM hospital_ibi_paiements WHERE DELETED_STATUS_PAIEMENT=0 AND REF_FACTURE_ID_PAIEMENT='".$factures->ID_FACTURE."' AND PAYMENT_TYPE_PAIEMENT!=3");
			if ($factures_caution->num_rows() > 0) {
				foreach ($factures_caution->result() as $factures_caution) {
						$CAUTION = $factures_caution->montant;
					}
				}
	  
		$type_facture = $this->input->get("type_facture");

		if ($type_facture == 'assurance' || $type_facture =='client') {
		
?>



<section class="content">
   <div class="row" >
     
      <div class="col-md-12">
         <div class="box box-warning">
            <div class="box-body ">

               <!-- Widget: user widget style 1 -->
               <div class="box box-widget widget-user-2">
                 
                     <div class="row">
                           <div class="col-xs-12">
                                 <?php
                                 if ($letter == 'H') {
                                       ?>
                                    <h2 class="page-header">
                                       Facture N<sup>o</sup> <?php echo $factures->NUMERO_FACTURE . ' du ' . date_create($factures->DATE_CREATION_FACTURE)->format('d-m-Y'); ?>
                                       <br>
                                    </h2>
                                 <?php
                              } else {
                                 ?>
                                    Facture N<sup>o</sup> <?php echo $factures->NUMERO_FACTURE . ' du ' . date_create($factures->DATE_CREATION_FACTURE)->format('d-m-Y'); ?>
                                 <?php
                              }
                           ?>
                        </div>
                  </div>



      <!-- entete de la facture  -->
		<div class="row invoice-info">
			<?php
            if ($letter == 'H') {
                  ?>
               <div class="col-sm-4 col-lg-4 col-md-4  invoice-col">
                  <address>
                     <img src="<?= BASE_ASSET; ?>/img/list.png" height="140px">
                  </address>
               </div>

               <div class="col-sm-4 col-lg-4 col-md-4 invoice-col">
               <?php
            } else {
				?>
					<div class="row invoice-info" style="margin-left:15px">
					<?php
				}
			?>
					A. Identification du vendeur:
					<address>
						<strong>Raison sociale*: Test</strong><br>

						NIF*: 4000006082<br>

						Registre de commerce No: 69490<br>

						B.P 2986, Tél: 22 275636 - 22 275632<br>

						Commune: Mukaza Quartier: KABONDO<br>
						Av.RIRIKUMUTIMA,Rue:RIRIKUMUTIMA,No20<br>
						Assujetti à la TVA: Non<br>
						Centre fiscal: DGC<br>
						Secteur d'activités: SOINS DE SANTE<br>
						Forme Juridique: SA

					</address>

				</div>

         
				<?php
				if ($letter == 'H') {
						?>
					<div class="col-sm-4 invoice-col">
					<?php
				} else {
					?>
						<div class="row invoice-info" style="margin-left:15px">
						<?php
					}
				?>
						B. Le Client:
						<address>
							<strong>R.S: <?php echo $get_patient_info->NOM_PATIENT . ' ' . $get_patient_info->PRENOM_PATIENT; ?></strong><br>
							Dossier No: <?php echo $get_patient_file_info->PATIENT_FILE_CODE; ?><br>
							Société: <?php
												if ($ref_societe > 0) {
													$get_societe = $this->model_departements->getOne_data("hospital_ibi_societes","ID_SOCIETE=".$ref_societe);
													if (!empty($get_societe)) {
														echo $get_societe->NOM_SOCIETE;
													}else{
														echo 'la societe inexistant';
													} 
                         
														?>
                                              <br> Numero du bon: 
														<?php
														echo $bon_commandes;
													}
												?><br>
							NIF*: .............................<br>
							Resident à: ..........................<br>
							Assujetti à la TVA: &nbsp;&nbsp;
							<input type="checkbox" name="oui" id="oui">
							<label for="oui">Oui</label>
							&nbsp;&nbsp;
							<input type="checkbox" name="non" id="non">
							<label for="non">Non</label>
							<br>
							<strong>Medecin: <?php
																if ($doctor_id > 0) {
																		$get_user = $this->model_departements->getOne_data("aauth_users","id=".$doctor_id);
																		if (!empty($get_user)) {
																		echo $get_user->username.' '.$get_user->full_name;
																		} 
																}
																?>
                     </strong><br>
							Service: <?php
												if ($department_id > 0) {
														$get_depart = $this->model_departements->getOne_data("departements","ID_DEPARTEMENT=".$department_id);
														if (!empty($get_depart)) {
															echo $get_depart->DESIGNATION_DEPARTEMENT;
														} 
													}
												?> <br>
							<strong>Caution:
								<?php
								echo number_format($CAUTION).' Fbu';
								$payement_client_suprlus_total = 0;
								?>
							</strong>
						</address>
					</div>
				</div>


            <!-- si le patient a eu un lit sur son compte ou a ete hospitalise -->

 <form name="form_hospital_ibi_commandes" id="form_hospital_ibi_commandes" action="<?= base_url('administrator/hospital_ibi_commandes/index'); ?>">
                  
            <?php
						if ($letter == 'H') {
								?>

							<table class="table table-striped table-condensed">

								<thead>

									<tr>

										<th>Bloc</th>

										<th>Chambre</th>

										<th>Date d'admission </th>

										<th>Date de sortie </th>

										<th>Nbre Jrs</th>
										 <?php if ($type_facture == 'client') {
											        ?>
										              <th>Surplus</th>
										 <?php }   ?>

									</tr>

								</thead>

								<tbody>
								  <?php
                           
                             $bed_management = $this->model_hospital_ibi_commandes->retourner_les_donnees("bed_management","WHERE PATIENT_FILE_ID_BED_MANAGEMENT=".$factures->PATIENT_FILE_ID_FACTURE);
								      		foreach ($bed_management->result() as $bed_management) {
												$bed_id = $bed_management->BED_ID_BED_MANAGEMENT;
												$allotment_timestamp = $bed_management->ALLOTMENT_TIMESTAMP_BED_MANAGEMENT;
												$discharge_timestamp = $bed_management->DISCHARGE_TIMESTAMP_BED_MANAGEMENT;
												$bed_management_id = $bed_management->ID_BED_MANAGEMENT;
												$current_timestamp = date('Y-m-d H:i:s');
						
												//CALCULATE DAYS
												$datetime1 = new DateTime($allotment_timestamp);
												$datetime2 = new DateTime($current_timestamp);
												$interval = $datetime1->diff($datetime2);
												$days = $interval->format('%R%a');
												$days_spent = $days;
						
                                   
												// BED
												$bed = $this->db->query('select * from bed where ID_BED=' . $bed_id);
												if ($bed->num_rows() > 0) {
														foreach ($bed->result() as $bed) {
																$room_id = $bed->ROOM_ID_BED;
						
																// ROOM
																$room = $this->db->query('select * from room where ID_ROOM=' . $room_id);
																if ($room->num_rows() > 0) {
																		foreach ($room->result() as $room) {
																				$room_no = $room->NO_ROOM;
																				$floor_id = $room->FLOOR_ID_ROOM;
																				$room_price = $room->PRICE_ROOM;
																			}
																	}
						
																// FLOOR
																$floor = $this->db->query('select * from floor where ID_FLOOR=' . $floor_id);
																if ($floor->num_rows() > 0) {
																		foreach ($floor->result() as $floor) {
																				$floor_name = $floor->NAME_FLOOR;
																			}
																	} else {
																		$floor_name = 'N/A';
																	}
															}
													}
												//`TION FEES
												$accomodation_fees = $days_spent * $room_price;
                                    
                                     // get commande sejour
                                      $get_commandes = $this->model_departements->getOne_data("hospital_ibi_commandes","PATIENT_FILE_ID_HOSPITAL_IBI_COMMANDES=".$factures->PATIENT_FILE_ID_FACTURE);
                                    $get_produits_sejour = $this->model_hospital_ibi_commandes->retourner_les_donnees("hospital_ibi_commandes_produits"," WHERE REF_COMMAND_CODE='".$get_commandes->CODE."' AND NAME='Séjour'");
                          
                                       foreach ($get_produits_sejour->result() as $value_C_P) {
                                        
												?>
												     <tr>
                                                   <td><?php echo $floor_name; ?></td>

                                                   <td><?php echo $room_no; ?></td>

                                                   <td><?php
                                                         $allotment_date = date('d/m/Y', strtotime($allotment_timestamp));
                                                         echo $allotment_date;
                                                         ?></td>

                                                   <td>
												      <?php
														 $discharge_date = date('d/m/Y', strtotime($discharge_timestamp));
														 if ($discharge_date =='01/01/1970') {
															 
														 }else{
                                                             echo $discharge_date;
														 }
                                                         ?>
													</td>

                                                   <td><?php echo $value_C_P->QUANTITE; ?></td>
                                                 
												  <?php if ($type_facture == 'client') {
											        ?>
												   <td><?php
                                                         $payement_client_suprlus = $value_C_P->PRIX_CLIENT * $value_C_P->QUANTITE;
														 $payement_client_suprlus_total = $payement_client_suprlus_total+$payement_client_suprlus;
														 echo number_format($payement_client_suprlus).' FBu';
                                                         ?>
                                                </td>
											    <?php } ?>
                                          </tr>
                                         <?php 
                                       }
											}
								  ?>
									

								</tbody>
							</table>


							<p>&nbsp;</p>
						<?php
					}
				?>

            <!-- fin s'il s'agit d'un patient hosputalise qui a un lit -->

            <!-- affichage des donnees du facture -->
            
            <table class="table table-sm table-condensed ">


                           <thead>

                                    <tr>
                                             <th></th>
                                             <th>Qté</th>
                                             <th>P.U</th>
                                             <th>100%</th>
											
											 <?php 
											   if ($type_facture == 'assurance') {
												 ?>
                                                   <th>Part Patr</th>
												 <?php
											   }elseif ($type_facture == 'client') {
												 ?>
                                                    <th>Part Pers</th>  
												 <?php
											   }
											 ?>
                                    </tr> 

                           </thead>

                                    <tbody>
											<?php 
											// WATERMARK FOR OPEN PATIENT FILES
											
											$departement_array = array();
											$nombre_total = 0;
											$nombre_verifier = 0;
											if ($factures->STATUS_FACTURE <= 0) {
												?>
													<div class="watermark"></div>
													<div class="watermark">NON PAYÉ</div>
												<?php
												}
										$prix_total_100_percent = 0;
										$paid_by_insurance = 0;
										$total_to_be_paid = 0;
		
										$grouped_time = $this->model_hospital_ibi_commandes->get_commandes_data($patient_file_id);
										if ($grouped_time->num_rows() > 0) 
										{ 
											foreach ($grouped_time->result() as $grouped_time) 
											{ 
													$grouped_time_in_date = $grouped_time->date;
													if ($letter == 'H') {

														?>
														<tr>
														<td><strong><?php echo $grouped_time_in_date; ?></strong></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														 <?php 
															if ($type_facture == 'assurance') {
																?>
																<td></td>
																<?php
															}elseif ($type_facture == 'client') {
																?>
																<td></td>
																<?php
															}
															?>

														</tr>
													<?php
												}

											$grouped_department = $this->model_hospital_ibi_commandes->get_groupe_by_departement($patient_file_id);
											
											if ($grouped_department->num_rows() > 0) 
											{
											
													foreach ($grouped_department->result() as $grouped_department) 
													{
														$grouped_department_id = $grouped_department->DEPARTMENT;
														
														$actes_categorie = $this->db->query('select * from actes_categorie where ID_ACTES_CATEGORIE=' . $grouped_department_id);
													    	foreach ($actes_categorie->result() as $actes_categorie) {
																$department_name = $actes_categorie->DESIGNATION;	 
															}
															$categorie_to_print = $this->model_hospital_ibi_commandes->get_data_from_produits($grouped_department_id,$grouped_time_in_date,$patient_file_id);
											
														if ($categorie_to_print->num_rows() > 0) {


																?>
															<tr>
																<td><strong><?php 
														        $departement_array[] = $grouped_department_id;
																echo $department_name; ?></strong></td>
																<td></td>
																<td></td>
																<td></td>
																<td></td> 
																<?php 
																if ($type_facture == 'assurance') {
																	?>
																	<td></td>
																	<?php
																}elseif ($type_facture == 'client') {
																	?>
																	<td></td>
																	<?php
																}
																?> 
															</tr>
														<?php
														}



													$hospital_ibi_commandes_produits = $this->model_hospital_ibi_commandes->get_produits_list($patient_file_id);


													if ($hospital_ibi_commandes_produits->num_rows() > 0) 
													{
													
														foreach ($hospital_ibi_commandes_produits->result() as $hospital_ibi_commandes_produits) 
														{
																$REF_PRODUCT_CODEBAR =  $hospital_ibi_commandes_produits->REF_PRODUCT_CODEBAR;
																$date =  $hospital_ibi_commandes_produits->date;
																$item_department =  $hospital_ibi_commandes_produits->DEPARTMENT;
																$verification =  $hospital_ibi_commandes_produits->VERIFICATION;
																$NAME =  $hospital_ibi_commandes_produits->NAME;
																$QUANTITE =  $hospital_ibi_commandes_produits->QUANTITE;
																$DISCOUNT_AMOUNT =  $hospital_ibi_commandes_produits->DISCOUNT_AMOUNT;
																$DISCOUNT_PERCENT = $hospital_ibi_commandes_produits->DISCOUNT_PERCENT;
																$PRIX =  $hospital_ibi_commandes_produits->PRIX;
																$TOTAL = $QUANTITE * $PRIX;
																$converted_date = date('Y-m-d', strtotime($date));

																if ($converted_date == $grouped_time_in_date && $item_department == $grouped_department_id) {
																	$prix_total_100_percent += $TOTAL;

																	?>

																	<tr>

																	<td><?php echo $NAME; ?></td>

																	<td><?php echo $QUANTITE; ?></td>

																	<td><?php echo $PRIX; ?></td>

																	<td><?php echo $TOTAL; ?></td>
																	 <?php 
																	if ($type_facture == 'assurance') {
																		?>
																		<td> 
																	
																		<?php 
																				
																					$INSURANCE_AMOUNT = ($TOTAL * $DISCOUNT_PERCENT) / 100;
																				

																				$paid_by_insurance += $INSURANCE_AMOUNT;
																				echo $INSURANCE_AMOUNT; ?>
																		</td>
																		<?php
																		}elseif ($type_facture == 'client') {
																			?>
																			<td>
																			<?php 
																				$INSURANCE_AMOUNT = ($TOTAL * $DISCOUNT_PERCENT) / 100;
																				$paid_by_insurance += $INSURANCE_AMOUNT;
																				$AMOUNT_TO_BE_PAID = $TOTAL - $INSURANCE_AMOUNT;
																			
																			$total_to_be_paid += $AMOUNT_TO_BE_PAID;
																			echo $AMOUNT_TO_BE_PAID; 
																			?>
																			</td>
																			<?php
																		}
																		?>

																	
																	<td class="no-print">
																	  <?php echo $DISCOUNT_PERCENT.'%' ?>
																	</td>
																	<td class="no-print">
																	<?php
																		$nombre_total ++;
																		if ($verification == 1) {
																			$nombre_verifier ++;

																		?>
																			<input name="verified" type="checkbox" disabled value="verified" checked>
																		<?php
																	} else {
																		?>
																			<input name="verified" type="checkbox" disabled value="verified">
																		<?php
																	}
																	?>
																	</td>

																	</tr>

																<?php

															}
														}
												   }
												
											}
											
									}
								}
												
						}

                     ?>

                                       </tbody>
							</table>


                  <!-- partie total et signature -->

                  
					<div class="row">
						<?php 
						$count_not_verified = 0;
						if ($letter == 'H') {
								?>
							<div class="col-xs-6">
								
								<div class="text-muted well well-sm no-shadow" style="width:100%;heigth:50%;padding-top:2%">
								  <u><b class="">SERVICE ADMINISTRATIF ET FINANCIER:</b></u><br>
								   
								   <br>
								   <br>
								   <div class="hidden-print">
								       	<u>VERFICATION PAR SERVICE:</u><br>
												<?php 
												
												$numero = 1;
												$array_dep_non_verifier = array();

												if (!empty($get_verification_by_departement)) 
												{
													foreach ($get_verification_by_departement as $key_dep) 
													{ 
														$count_not_verified ++;
														$array_dep_non_verifier[] = $key_dep->DEPARTMENT;
														?>
															<?php echo $numero++ .')' ;
															// get departement
																			$get_depart = $this->model_departements->getOne_data("actes_categorie","ID_ACTES_CATEGORIE=".$key_dep->DEPARTMENT);
																			if (!empty($get_depart)) {
																				echo $get_depart->DESIGNATION;?>
																				<input class="checkInvoice" type="checkbox" name="departement_id[]" id="verifier_facture_id<?php echo $key_dep->DEPARTMENT ?>" value="<?php echo $key_dep->DEPARTMENT ?>" />
																				<?php
																			} 
																		
															?>
														<?php 
													}

													?>
								   
													<!-- TODO check if the user is from comptability or administration for check all check box -->
												
															<br>
																<span style="border:1px solid black"> 
																	<input type="checkbox" id="checkAllInvoices">selectionnez tous
																</span>
															<br>
															<br>
													
													<!-- deja verifie -->
											   <?php
											}
											

									 for ($i=0; $i < count($departement_array); $i++) { 
												   
											if (!in_array($departement_array[$i],$array_dep_non_verifier)) 
											{
														?>
															<?php echo $numero++ .')' ;
															// get departement
																			$get_depart = $this->model_departements->getOne_data("actes_categorie","ID_ACTES_CATEGORIE=".$departement_array[$i]);
																			if (!empty($get_depart)) {
																				echo $get_depart->DESIGNATION;?>
																				<input disabled class="checkInvoice1" type="checkbox"  checked />
																				<?php
																			} 
																		
															?> <br>
														<?php 
												
											}
										}
											   
											?>
								   </div>

								</div>
							<?php
						} else {
							?>
								<div class="col-xs-12">
								<?php
							}
						?>
							</div>
							<!-- /.col -->
							<?php
							if ($letter == 'H') {
									?>
								<div class="col-xs-6">
								<?php
							} else {
								?>
									<div class="col-xs-12">
									<?php
								}
							?>
									<div>
										<table class="table table-condensed table-sm">
											
											
											 <?php 
														if ($type_facture == 'assurance') {
																?>	<tr>
																		<th style="width:50%">Total part patronal:</th>
																		<td><?php echo number_format($paid_by_insurance); ?> Fbu</td>
																	</tr>
																<?php
															}elseif ($type_facture == 'client') {
																?> <tr>
																		<th style="width:50%">Total par personnel:</th>
																		<td><?php echo number_format($total_to_be_paid); ?> Fbu</td>
																	</tr>
																<?php
															}
															?>
					                                   <?php
														if ($CAUTION > 0) {
																if ($type_facture == 'assurance') {

																}elseif ($type_facture=='client') {
																		?>
																	<tr class="no-print">
																		<th>Caution</th>
																		<td>
																			<?php echo number_format($CAUTION); ?> Fbu
																		</td>
																	</tr>
																<?php
																}
																			
														}
								     	?>
											<tr>

												
												 <?php 
															if ($type_facture == 'assurance') {
																?>	
														   <th>Net à payer:</th>

												          <td>
																<?php 
																    	$final_total =$paid_by_insurance ;
																	 
																		echo number_format($final_total); ?> Fbu
												             </td>
															<?php
															}elseif ($type_facture == 'client') {
															  ?> 
																<th>Net à payer <?php if ($payement_client_suprlus_total > 0) 
																	{
																		echo 'avec Surplus';
																	} ?>
																:</th>

																<td><?php
																	 
																	$final_total = $prix_total_100_percent - $paid_by_insurance - $CAUTION + $payement_client_suprlus_total;
																		
																	echo number_format($final_total); ?> Fbu
																</td>

																<?php
															}
													?>
											</tr>
											<tr>
											</tr>
										</table>
										<?php
										/* CONVERT NUMBER TO WORDS */
										function convertNumberToWord($num = false)
										{
											$num = str_replace(array(',', ' '), '', trim($num));
											if (!$num) {
												return false;
											}
											$num = (int)$num;
											$words = array();
											$list1 = array(
												'', 'un', 'deux', 'trois', 'quatre', 'cinq', 'six', 'sept', 'huit', 'neuf', 'dix', 'onze',
												'douze', 'treize', 'quatorze', 'quinze', 'seize', 'dix-sept', 'dix-huit', 'dix-neuf'
											);
											$list2 = array('', 'dix', 'vingt', 'trente', 'quarante', 'cinquante', 'soixante', 'septante', 'quatre-vingts', 'nonante', 'cent');
											$list3 = array(
												'', 'mille', 'million', 'milliard', 'billion', 'quadrillion', 'quintillion', 'sextillion', 'septillion',
												'octillion', 'nonillion', 'decillion', 'undecillion', 'duodecillion', 'tredecillion', 'quattuordecillion',
												'quindecillion', 'sexdecillion', 'septendecillion', 'octodecillion', 'novemdecillion', 'vigintillion'
											);
											$num_length = strlen($num);
											$levels = (int)(($num_length + 2) / 3);
											$max_length = $levels * 3;
											$num = substr('00' . $num, -$max_length);
											$num_levels = str_split($num, 3);
											for ($i = 0; $i < count($num_levels); $i++) {
												$levels--;
												$hundreds = (int)($num_levels[$i] / 100);
												$hundreds = ($hundreds ? ' ' . $list1[$hundreds] . ' cent' . ' ' : '');
												$tens = (int)($num_levels[$i] % 100);
												$singles = '';
												if ($tens < 20) {
													$tens = ($tens ? ' ' . $list1[$tens] . ' ' : '');
												} else {
													$tens = (int)($tens / 10);
													$tens = ' ' . $list2[$tens] . ' ';
													$singles = (int)($num_levels[$i] % 10);
													$singles = ' ' . $list1[$singles] . ' ';
												}
												$words[] = $hundreds . $tens . $singles . (($levels && ( int )($num_levels[$i])) ? ' ' . $list3[$levels] . ' ' : '');
											} //end for loop
											$commas = count($words);
											if ($commas > 1) {
												$commas = $commas - 1;
											}
											return implode(' ', $words);
										}
										?>
										Le montant de: <strong><?php

											if($final_total < 0)
											{
											$final_total = $final_total*(-1);
											echo 'moins '.convertNumberToWord($final_total).'Francs Burundais'; 
											}
											else
											{
											echo convertNumberToWord($final_total).'Francs Burundais'; 
											}
																		 ?>
                              </strong>
									</div>
								</div>
								<!-- /.col -->
							</div>


                 
                    <br>
                    <br>
					<input type="hidden" name="patient_file_id" id="patient_file_id" value="<?php echo $patient_file_id ?>">
					<input type="hidden" name="facture_id" id="facture_id" value="<?php echo $factures->ID_FACTURE ?>">
                    <div class="view-nav hidden-print">
                        
                        <a class="btn btn-flat btn-danger btn_action" id="btn_back" title="back (Ctrl+x)" href="<?= site_url('administrator/hospital_ibi_commandes/'); ?>"><i class="fa fa-undo" ></i>Retour </a>
                        <?php
						 if ($count_not_verified <= 0) {
							?>
							<button class="btn btn-flat btn-default" id="Imprimer" onclick="window.print()" title="Imprimer la facture" ><i class="fa fa-print" ></i> Imprimer</button>
							<?php
						 }
						  if($factures->STATUS_FACTURE==0){
							?>
							<label for="test">Pas payer</label>
							<?php 
						 }else {
							 ?>
							 <label for="test">Déjà payer</label>
							<?php 
						 }
						?>
					 </div>
					 </form> 
                    
                  </div>
               </div>
            </div>
            <!--/box body -->
         </div>
         <!--/box -->

      </div>
   </div>
</section>
<!-- /.content -->
<script>

"use strict";

function init() {
    $("#checkAllInvoices").click(function(){
        var checked = this.checked;
        $('.checkInvoice').each(
            function() {
                if (this.checked != checked) $(this).trigger('click');
            }
        );
    });

    $('.checkInvoice').on('change', function() {
		var bulk = this.value;
        var serialize_bulk = $('#form_hospital_ibi_commandes').serialize();
		console.log("data: ",serialize_bulk);
		if($(this).prop("checked") == true){
                
				if (bulk) {
					swal({
						title: "<?= cclang('are_you_sure'); ?>",
						text: "<?= 'Après verification , le retour en arriere sera impossible'; ?>",
						type: "warning",
						showCancelButton: true,
						confirmButtonColor: "#DD6B55",
						confirmButtonText: "<?= ('Oui verifier'); ?>",
						cancelButtonText: "<?= ('Non'); ?>",
						closeOnConfirm: true,
						closeOnCancel: true,
						animation:"slide-from-top", 
					},
					function(isConfirm){
						if (isConfirm) {
						var code_commande = $("#code_commande").val();
						console.log("OK :"+bulk+" Commande "+code_commande);
							   document.location.href = BASE_URL + 'administrator/hospital_ibi_commandes/verifier?'+serialize_bulk;      
						}
					});

					return false;

				}

            }
            else if($(this).prop("checked") == false){
				// if is not checked 
                console.log("Checkbox is unchecked."+this.value);
            }

		return false;
 
    });
}

$( document ).ready(init)
</script>

<?php 
    // fin test si il a selectionne un des boutons de separation facture assurance ou client
		} else {
			echo '<span style="margin:2%">VEILLEZ SELECTIONNER UNE DES BOUTONS CLIENTS OU ASSURANCE... MERCI </span>';
          ?><br>
			<a style="margin:2%" class="btn btn-flat btn-danger btn_action" id="btn_back" title="back (Ctrl+x)" href="<?= site_url('administrator/hospital_ibi_commandes/'); ?>"><i class="fa fa-undo" ></i>Retour </a>
		<?php
		}
?>