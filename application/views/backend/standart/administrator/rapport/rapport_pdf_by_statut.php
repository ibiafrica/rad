<script>
  $(function() {
    $('.chosen-select').chosen();
    $('.chosen-select-deselect').chosen({
      allow_single_deselect: true
    });
  });
</script>

<style>
  .list-group-item:hover {
    background-color: #cccccc4a !important;
    cursor: pointer;
  }
</style>

<script src="<?= BASE_ASSET; ?>/js/jquery.hotkeys.js"></script>

<script type="text/javascript">
  //This page is a result of an autogenerated content made by running test.html with firefox.
  function domo() {

    // Binding keys
    $('*').bind('keydown', 'Ctrl+a', function assets() {
      window.location.href = BASE_URL + '/administrator/pos_ibi_commandes/add';
      return false;
    });

    $('*').bind('keydown', 'Ctrl+f', function assets() {
      $('#sbtn').trigger('click');
      return false;
    });

    $('*').bind('keydown', 'Ctrl+x', function assets() {
      $('#reset').trigger('click');
      return false;
    });

    $('*').bind('keydown', 'Ctrl+b', function assets() {

      $('#reset').trigger('click');
      return false;
    });
  }

  jQuery(document).ready(domo);
</script>
<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Pos rapport commande detail par statut </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
    <li class="active">Pos rapport commande detail par statut</li>
  </ol>
</section>
<!-- Main content -->
<section class="content">
  <div class="row">

    <div class="col-md-12">
      <div class="box box-warning">
        <div class="box-body " id="table">
        <br>
        <br>
                 <strong>Server :<?php echo $this->db->get_where('aauth_users',array('id'=>$this->uri->segment(4)))->row()->full_name;?></strong> <br>
                 <strong>
                    Status commande:
                      <?php  
                           $status=$this->uri->segment(5);
                           if ($status==0) {
                               echo '<span class="bg-yellow badge">Impayer</span>';
                           }elseif ($status==2) {
                               echo '<span class="bg-green badge">Payer</span>';
                           }elseif ($status==1) {
                               echo '<span class="bg-blue badge">En avance</span>';
                           }elseif ($status==11) {
                               echo '<span class="bg-blue badge">Complementaire</span>';
                           }else {
                               echo '<span class="bg-blue badge">Credit</span>';
                           }
                        ?>
                 </strong><br>
                 <strong>
                    Total:
                    <?php 
                          $somme=null;
                          foreach ($commande as $tot) { 
                            $commande_id_tot=$tot->ID_pos_IBI_COMMANDES;
                             $count_tot = $this->db->query('SELECT SUM(PRIX_TOTAL) AS TOTAL FROM pos_ibi_commandes_produits WHERE pos_IBI_COMMANDES_ID='.$commande_id_tot)->row();
                             $somme+=$count_tot->TOTAL;
                          }

                          echo $somme.' Fbu';

                      ?>
                 </strong>
                       
                <?php ?>

                <button class="btn btn-flat btn-primary pull-right print">Imprimer</button>
                
                <?php  foreach ($commande as $k) { ?>
                
                    <table  border="1px" style="width:100% !important" >
                    <tr class="h">
                    <td class="h" colspan="4" style="height:40px;color:white !important;background:gray;padding:5px">
                     <strong style="font-color:white !important">
                      Code commande :<?php echo $k->CODE ?>
                    </strong></td>
                    </tr>
                    <br>
                    <tr>
                    <td colspan="1" style="width:25% !important">Designation</td>
                    <td style="width:25% !important">Codebar</td>
                    <td style="width:25% !important">Quantite</td>
                    <td style="width:25% !important">Prix</td>
                    </tr>
                      <?php  
                        $commande_id=$k->ID_pos_IBI_COMMANDES;
                        $produits = $this->db->get_where('pos_ibi_commandes_produits',array('pos_IBI_COMMANDES_ID'=>$commande_id))->result();
                         foreach ($produits as $p) { ?>
                            <tr>
                            <td colspan="1" style="width:25% !important"><?php echo $p->NAME; ?></td>
                            <td style="width:25% !important"><?php echo $p->REF_PRODUCT_CODEBAR; ?></td>
                            <td style="width:25% !important"><?php echo $p->QUANTITE; ?></td>
                            <td style="width:25% !important"><?php echo $p->PRIX_TOTAL; ?></td>
                            </tr>
                        <?php }
                            
                      ?>

                        <tr>
                            <td colspan="3" style="width:25% !important;font-weight:bold">Total</td>
                           
                            <td style="background:gray;color:white">
                            <?php
                              $count = $this->db->query('SELECT SUM(PRIX_TOTAL) AS TOTAL FROM pos_ibi_commandes_produits WHERE pos_IBI_COMMANDES_ID='.$commande_id)->row();
                              echo '<strong>'.$count->TOTAL.' Fbu</strong>';
                            ?>
                            </td>
                            </tr>
                    </table>
                   
                     
                    
               <?php } ?>

          

        </div>
        <!--/box body -->
      </div>
      <!--/box -->
    </div>
  </div>
</section>



<script>
  $('.print').on('click', function() {
    const id = $(this).attr('data-attr');
    console.log(" Vous etes  " + id);
    var table = document.getElementById('table');
    // console.log(table);
    var ctx = table.outerHTML;
    var idname = name;
    var frame1 = document.createElement('iframe');
    frame1.name = "frame1";
    frame1.style.position = "absolute";
    frame1.style.top = "-1000000px";
    document.body.appendChild(frame1);
    var frameDoc = frame1.contentWindow ? frame1.contentWindow : frame1.contentDocument.document ? frame1
      .contentDocument.document : frame1.contentDocument;
    frameDoc.document.open();
    frameDoc.document.write('<html><head><title></title>');
    frameDoc.document.write(
      '<style>body{margin:10px !important}table {  border-collapse: collapse;  border-spacing: 0; width:100%; margin-top:20px;} .table td, .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th{ padding:8px 18px;border:1px  } .table-bordered, .table-bordered > tbody > tr > td, .table-bordered > tbody > tr > th, .table-bordered > tfoot > tr > td, .table-bordered > tfoot > tr > th, .table-bordered > thead > tr > td, .table-bordered > thead > tr > th {     border: 1px solid #000;}p + p { margin-left: 30px;}.body{width:100% !important}.no{display:none !important}.print{display:none !important}.h{background-color:black !important;background:black} </style>'
    ); // your title
    frameDoc.document.title = "Facture";
    frameDoc.document.write('<meta charset="utf-8"></head><body>');
    frameDoc.document.write(ctx);
    frameDoc.document.write('</body></html>');
    frameDoc.document.close();
    setTimeout(function() {
      window.frames["frame1"].focus();
      window.frames["frame1"].print();
      document.body.removeChild(frame1);
    }, 100);

  });
</script>

<script>
  $('.prints').on('click', function() {
    const id = $(this).attr('data-attr');
    console.log(" Vous etes  " + id);
    var table = document.getElementById('targets_' + id);
    // console.log(table);
    var ctx = table.outerHTML;
    var idname = name;
    var frame1 = document.createElement('iframe');
    frame1.name = "frame1";
    frame1.style.position = "absolute";
    frame1.style.top = "-1000000px";
    document.body.appendChild(frame1);
    var frameDoc = frame1.contentWindow ? frame1.contentWindow : frame1.contentDocument.document ? frame1
      .contentDocument.document : frame1.contentDocument;
    frameDoc.document.open();
    frameDoc.document.write('<html><head><title></title>');
    frameDoc.document.write(
      '<style>body{margin:10px !important}table {  border-collapse: collapse;  border-spacing: 0; width:100%; margin-top:20px;} .table td, .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th{ padding:8px 18px;border:1px  } .table-bordered, .table-bordered > tbody > tr > td, .table-bordered > tbody > tr > th, .table-bordered > tfoot > tr > td, .table-bordered > tfoot > tr > th, .table-bordered > thead > tr > td, .table-bordered > thead > tr > th {     border: 1px solid #000;}p + p { margin-left: 30px;}.body{width:100% !important}.no{display:none !important} </style>'
    ); // your title
    frameDoc.document.title = "Facture";
    frameDoc.document.write('<meta charset="utf-8"></head><body>');
    frameDoc.document.write(ctx);
    frameDoc.document.write('</body></html>');
    frameDoc.document.close();
    setTimeout(function() {
      window.frames["frame1"].focus();
      window.frames["frame1"].print();
      document.body.removeChild(frame1);
    }, 100);

  });
</script>


<script>
  var selectedcmd = undefined;
  $(document).ready(function() {


         var x = 0;
        $('.prix_total').each(function(){
            x += parseFloat($(this).val());  
        });
       $("#total_all").text(x)
      const remise =  $(".total_all_val").val(x);
       console.log("Les dernier:"+remise)
       

   // console.log("okayl....");
    $('.btnoptions').click(function(e) {
      selectedcmd = $(this).data('cmdid');
      $("#confirmedit").show();
    });

    $('.confirmEdit').on('click', function() {
      const num = $(this).data('type');
      window.location.href = "<?= site_url('administrator/pointdesventes/update_commande/'); ?>" + selectedcmd + '/' + num;
    });
    $('.cancelEdit').on('click', function() {
      $("#confirmedit").hide();
    });


    $('.remove-data').click(function() {

      var url = $(this).attr('data-href');

      swal({
          title: "<?= cclang('are_you_sure'); ?>",
          text: "<?= cclang('data_to_be_deleted_can_not_be_restored'); ?>",
          type: "input",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "<?= cclang('yes_delete_it'); ?>",
          cancelButtonText: "<?= cclang('no_cancel_plx'); ?>",
          closeOnConfirm: true,
          closeOnCancel: true,
          animation: "slide-from-top",
          inputPlaceholder: "Donnez un commentaire S.V.P."
        },
        function(inputValue) {
          if (inputValue === false) {
            return false;
          }
          if (inputValue === "") {
            swal.showInputError("Vous devriez ecrire un commentaire SVP.!!!");
            return false;
          }
          document.location.href = url + '?inputValue=' + inputValue;
        },
        function(isConfirm) {
          // if (isConfirm) {
          // document.location.href = BASE_URL + '/administrator/pos_ibi_commandes/delete?' + serialize_bulk;
          // }
        });

      return false;
    });
  }); /*end doc ready*/
</script>

<script>
  function remise(params) {
     // $(".prix_total_"+params).val(0);
      const quantite = $(".quantite_"+params).val();
      const prix = $(".prix_"+params).val();
      const prix_total = $(".prix_total_"+params).val();
      const nbr = $(".item_"+params).val();
      var n = parseFloat(nbr) + parseFloat(prix);
      $(".prix_total_"+params).val(n);
      $(".prix_ti_"+params).text(n);
      $(".prix_tot_"+params).text(n*quantite);
      $("#total_all").text("");
      console.log("Sommes :"+prix_total); 
      //sommees();

       var sum = 0;
        $('.prix_total').each(function(){
            isNaN(this.value) || 0 == this.value.length || (sum += parseFloat(this.value))
             console.log("Sommes :"+sum);
        });
       
        
        $("#total_all").text(sum)  
        $(".total_all_val").val(sum) 

  }

  function sommees() {
         //sommes total 
         var sum = 0;
        $('.prix_total').each(function(){
             isNaN(this.value) || 0 == this.value.length || (sum += parseFloat(this.value))
             //console.log("Sommes :"+sum);
        });
       
        
        $("#total_all").text(sum)  
        $(".total_all_val").val(sum) 

    //     const remisec =  $(".total_all_val").val();
    //    console.log("Les dernier:"+remisec)
  }

        function remise_global() {
            $("#total_all").text("") 
            const remise_global= $("#remise_globale").val();
            const total = $(".total_all_val").val();
            const nbt_tot = parseFloat(remise_global) + parseFloat(total);
            console.log("bingo"+nbt_tot)
            $("#total_all").text(nbt_tot)
             $(".total_all_val").val(nbt_tot) 


        }

    function type_remise() {
        
    }
  
</script>