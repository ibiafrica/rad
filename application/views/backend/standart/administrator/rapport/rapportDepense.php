<script src="<?= BASE_ASSET; ?>/js/jquery.hotkeys.js"></script>

<script type="text/javascript">
  //This page is a result of an autogenerated content made by running test.html with firefox.
  function domo() {

    // Binding keys
    $('*').bind('keydown', 'Ctrl+a', function assets() {
      window.location.href = BASE_URL + '/administrator/transfert/add';
      return false;
    });

    $('*').bind('keydown', 'Ctrl+f', function assets() {
      $('#sbtn').trigger('click');
      return false;
    });

    $('*').bind('keydown', 'Ctrl+x', function assets() {
      $('#reset').trigger('click');
      return false;
    });

    $('*').bind('keydown', 'Ctrl+b', function assets() {

      $('#reset').trigger('click');
      return false;
    });
  }

  jQuery(document).ready(domo);
</script>
<!-- Content Header (Page header) -->
<div class="trdata"></div>
<section class="content-header">
  <h1>
    Rapports <small> des depenses</small>
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-dashboard"></i> Rapports</a></li>
    <li class="active">Rapports des depenses</li>
  </ol>
</section>
<!-- Main content -->


<section class="content" id="mypage">
  <div class="row">

    <div class="col-md-12">
      <div class="box box-warning">
        <div class="box-body ">
          <div class="box box-widget widget-user-2">
            <!--  -->

          </div>
          <form name="form_trans" id="form_trans" action="<?= site_url('rapports/depenseRapports'); ?>">

            <div class="row">
              <div class="col-md-10 ">


                <div class="col-lg-4 col-md-4 col-sm-4 padd-left-0  ">

                  <div class="form-group">
                    <div class="input-group">
                      <span class="input-group-addon">Debut</span>
                      <input type="text" class="form-control dateTimePickers" name="date_start" value="<?= $this->input->get('date_start') ?>">
                    </div>
                  </div>


                </div>

                <div class="col-lg-4 col-md-4 col-sm-4 padd-left-0  ">
                  <div class="form-group">
                    <div class="input-group">
                      <span class="input-group-addon">Fin</span>
                      <input type="text" class="form-control dateTimePickers" name="date_end" value="<?= $this->input->get('date_end') ?>">
                    </div>
                  </div>
                </div>


                <div class="col-lg-4 col-md-4 col-sm-4">
                  <div class="form-group">
                    <select class="form-control" name="type_categorie">
                      <option value=""> Type de categorie</option>
                      <?php $type_categorie = $this->db->query("SELECT * FROM pos_categorie_depense WHERE DELETE_STATUS_CATEGORIE_DEPENSE = 0 ")->result();
                      foreach ($type_categorie as $key) { ?>
                        <option <?= $this->input->get('type_categorie') == $key->ID_CATEGORIE_DEPENSE ? "selected" : "" ?> value="<?php echo $key->ID_CATEGORIE_DEPENSE ?>"> <?php echo $key->NOM_CATEGORIE_DEPENSE ?></option>
                      <?php } ?>

                    </select>

                  </div>
                </div>

              </div>

              <div class="col-md-2 ">
                <div class="pull-right">

                  <button type="submit" name="name" class="btn btn-default"><i class="fa fa-refresh"></i>
                  </button>

                  <button id="btnprint" title="imprimer le rapport de vente" type="button" class="btn btn-default"><i class="fa fa-print"></i></button>

                  <a class="btn btn-flat btn-success" title="<?= cclang('export'); ?> rapport de vente"><i class="fa fa-file-excel-o"></i></a>
                </div>
              </div>
            </div>
          </form>
          <hr>
          <div class="table-responsive row">
            <table class="table table-bordered table-striped dataTable" id="mytable">
              <thead>
                <tr class="">
                  <th>No</th>
                  <th>Designation Dep.</th>
                  <th>Categorie Dep. </th>
                  <th>Soumis par</th>
                  <th>Date Creer</th>
                  <th>Montant Dep.</th>

                </tr>
              </thead>
              <tbody id="id_table_depense">
                <?php $nBr = 0;
                $sum = 0;
                foreach ($getter_depense as $depense) {
                  $sum += $depense->MONTANT_DEPENSE;
                  $nBr++; ?>
                  <tr>
                    <td><?= $nBr ?></td>
                    <td><?= $depense->NOM_DEPENSE ?></td>
                    <td> <?= $this->db->query("SELECT * FROM pos_categorie_depense WHERE ID_CATEGORIE_DEPENSE =  '" . $depense->ID_CATEGORIE_DEPENSE . "' ")->row_array()['NOM_CATEGORIE_DEPENSE']; ?>
                    </td>
                    <td>
                      <?= $this->db->query("SELECT * FROM aauth_users WHERE id = '" . $depense->CREATE_BY_DEPENSE . "' ")->row_array()['full_name']; ?>
                    </td>

                    <td>
                      <?php
                      echo $depense->DATE_CREATE_DEPENSE;
                      ?>
                    </td>
                    <td> <?= $depense->MONTANT_DEPENSE ?> </td>

                  </tr>
                <?php } ?>

              <tfoot>
                <tr style="background-color: rgba(0,0,0,0.1);">
                  <th colspan="5"> <i>TOTAL </i></th>
<!--                   <th> <b> <?= $SommesDepense['MONTANT'] ?> </b></th>
 -->                </tr>
                </tr>



              </tfoot>
              </tbody>

              <tfoot>
              </tfoot>

            </table>
          </div>
        </div>
        <hr>



      </div>
      <!--/box body -->
    </div>
    <!--/box -->
  </div>
  </div>
</section>
<!-- /.content -->

<!-- Page script -->
<script>
  function getCommanderDate() {
    let selecter_date = $('#selecter_date').val();

    let uri = <?php echo $this->uri->segment(2); ?>;


    $.ajax({
      url: BASE_URL + "rapports/<?php echo $this->uri->segment(2) ?>/getcommandData",
      type: 'post',
      dataType: 'json',
      data: {
        selecter_date: selecter_date,
        "<?php echo $this->security->get_csrf_token_name(); ?>": "<?php echo $this->security->get_csrf_hash(); ?>"
      },
      success: function(datas) {
        // alert(datas);
        console.log(datas)
        $('#id_table_one').html(datas.showAll);
      }


    })
    // alert(selecter_date);
  }




  $(document).on('click', '#btnprint', function() {
    // let data=$('#mytable').html();
    // $('.trdata').html(data);
    window.print();
  })
</script>

<script>
  $('#btnprint').on('click', function() {
    //   const id = $(this).attr('data-attr');
    //   console.log(" Vous etes  "+id);
    var table = document.getElementById('mytable');
    // console.log(table);
    var ctx = table.outerHTML;
    var idname = name;
    var frame1 = document.createElement('iframe');
    frame1.name = "frame1";
    frame1.style.position = "absolute";
    frame1.style.top = "-1000000px";
    document.body.appendChild(frame1);
    var frameDoc = frame1.contentWindow ? frame1.contentWindow : frame1.contentDocument.document ? frame1
      .contentDocument.document : frame1.contentDocument;
    frameDoc.document.open();
    frameDoc.document.write('<html><head><title></title>');
    frameDoc.document.write(
      '<style>body{margin:10px !important}table {  border-collapse: collapse;  border-spacing: 0; width:100%; margin-top:20px;} .table td, .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th{ padding:8px 18px;border:1px  } .table-bordered, .table-bordered > tbody > tr > td, .table-bordered > tbody > tr > th, .table-bordered > tfoot > tr > td, .table-bordered > tfoot > tr > th, .table-bordered > thead > tr > td, .table-bordered > thead > tr > th {     border: 1px solid #000;}.no{display:none !important} </style>'
    ); // your title
    frameDoc.document.title = "Facture";
    frameDoc.document.write('<meta charset="utf-8"></head><body>');
    frameDoc.document.write(ctx);
    frameDoc.document.write('</body></html>');
    frameDoc.document.close();
    setTimeout(function() {
      window.frames["frame1"].focus();
      window.frames["frame1"].print();
      document.body.removeChild(frame1);
    }, 100);

  });
</script>

<style type="text/css">
  @media all {
    .page-break {
      display: none;
    }

    .trdata {
      display: none;
    }

    .header_title {
      display: none;
      text-align: center;
    }
  }

  @media print {
    .page-break {
      display: block;
      page-break-before: always;
    }

    #form_trans {
      display: none;
    }

    .trdata {
      display: block;
    }

    .header_title {
      display: block;
      text-align: center;
    }

    .main-footer {
      display: none;
    }

    table tbody tr td {
      border: 1px solid #000 !important;
    }

    .view-nav,
    .main-footer,
    #btn_print,
    .title,
    .btn,
    #myform,
    .widget-user-header {
      display: none !important;
    }

    a {
      display: none !important;
    }

    .print {
      text-align: center !important;
      background-color: #0002 !important;
    }


    table td {
      border: 1px solid #000 !important;
    }

    td {
      border: 1px solid #000 !important;
    }

    table tr th {
      border: 1px solid black !important;

    }

    th {
      background-color: green !important;
    }

    img {
      margin-top: 15% !important;

    }


    .celldiv {
      background-color: #999 !important;
    }

  }
</style>


<script type="text/javascript">
    $(".dateTimePickers").datetimepicker({
        maxDate: new Date(),
        maxDateTime:new Date().getTime(),
        format: "Y-m-d H:i:s",
        autoclose: true,
        todayBtn: true,
        startDate: "Y-m-d H:i:s",
        step: 1
    });
</script>