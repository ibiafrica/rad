
<script src="<?= BASE_ASSET; ?>/js/jquery.hotkeys.js"></script>

<script type="text/javascript">
//This page is a result of an autogenerated content made by running test.html with firefox.
function domo(){
 
   // Binding keys
   $('*').bind('keydown', 'Ctrl+a', function assets() {
       window.location.href = BASE_URL + '/administrator/transfert/add';
       return false;
   });

   $('*').bind('keydown', 'Ctrl+f', function assets() {
       $('#sbtn').trigger('click');
       return false;
   });

   $('*').bind('keydown', 'Ctrl+x', function assets() {
       $('#reset').trigger('click');
       return false;
   });

   $('*').bind('keydown', 'Ctrl+b', function assets() {

       $('#reset').trigger('click');
       return false;
   });
}

jQuery(document).ready(domo);
</script>
<!-- Content Header (Page header) -->
<div class="trdata"></div>
<section class="content-header">
   <h1>
      Rapports <small> des ventes. -></small>
   </h1>
   <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Rapports</a></li>
      <li class="active">Rapports des ventes</li>
   </ol>
</section>
<!-- Main content -->


<section class="content" id="mypage">
   <div class="row" >
      
      <div class="col-md-12">
         <div class="box box-warning">
            <div class="box-body ">
               <!-- Widget: user widget style 1 -->
               <div class="box box-widget widget-user-2">
                  <!-- Add the bg color to the header using any of the bg-* classes -->
                  <div class="widget-user-header ">
                    
                     <div class="widget-user-image">
                        <img class="img-circle" src="<?= BASE_ASSET; ?>/img/list.png" alt="User Avatar">
                     </div>
                     <!-- /.widget-user-image -->
                     <h3 class="widget-user-username">__Pour la vente__
                             
                     </h3>
                     <br>
                    </div>
                  </div>
                  <!-- <b class="header_title">Rapport de paiements<?= $this->input->get('debut'); ?> au <?= $this->input->get('fin'); ?></b> -->
                  <form name="form_trans" id="form_trans" action="<?= site_url('rapports/rapport_ventes'); ?>">
                  
                      <!-- /.widget-user -->
               <div class="row" >
                  <div class="col-md-10 ">
                     
                    
                     <div class="col-lg-6 col-md-6 col-sm-6 padd-left-0  " >

                        <div class="form-group">
                          <div class="input-group">
                            <span class="input-group-addon">Start</span>
                            <input type="text" class="form-control dateTimePickers" name="date_start" value="">
                          </div>
                        </div>

                     </div>

                     <div class="col-lg-6 col-md-6 col-sm-6 padd-left-0  " >
                         <div class="form-group">
                          <div class="input-group">
                            <span class="input-group-addon">End</span>
                            <input type="text" class="form-control dateTimePickers" name="date_end" value="">
                          </div>
                        </div>
                     </div>
             
                  </div>

                  <div class="col-md-2 ">
                   <div class="pull-right">

                     <button type="submit" name="name" class="btn btn-default"><i class="fa fa-refresh"></i>
                        </button>

                     <button id="btnprint" title="imprimer le rapport de vente" type="button" class="btn btn-default"><i class="fa fa-print"></i></button>

                     <a class="btn btn-flat btn-success" title="<?= cclang('export'); ?> rapport de vente"><i class="fa fa-file-excel-o" ></i></a>
                   </div>
                  </div>
                  </div>
                   </form>  
                    <hr>
                  <div class="table-responsive row"> 
                  <table class="table table-bordered table-striped dataTable" id="mytable">
                     <thead>
                        <tr class="">
                          <th>No</th>
                           <th>Code_Bar</th>
                           <th>DESIGNATION</th> 
                           <th>Nbres_ vendue</th>
                           <th>Prix Total</th>
                           <th>Prix dAchat</th>
                           <th>Prix de vente</th>
                           <th>Benefice</th>
                        </tr>
                     </thead>
                     <tbody id="id_table_one">
                        <?php $n = 0; foreach($getterOner as $namer){ $n++; ?>
                        <tr>
                          <td> <?= $n;?></td>
                          <td> <?= $namer->REF_PRODUCT_CODEBAR?></td>
                          <td>  <?php $produit = $this->db->query("SELECT * FROM pos_store_1_ibi_articles WHERE CODEBAR_ARTICLE = '".$namer->REF_PRODUCT_CODEBAR."' ")->row_array();
                              echo $produit['DESIGN_ARTICLE'];
                           ?>
                          </td>
                          <td width="200px"> <?php ECHO $counter = $this->db->query("SELECT * FROM pos_ibi_commandes_produits WHERE REF_PRODUCT_CODEBAR ='".
                            $namer->REF_PRODUCT_CODEBAR."' ")->num_rows();?> 
                          </td>
                          <td> 
                             <? $total_prx_qte = $this->db->query("SELECT * FROM pos_store_1_ibi_articles WHERE CODEBAR_ARTICLE = '".$namer->REF_PRODUCT_CODEBAR."' ")->row_array();
                               $to = $total_prx_qte['PRIX_DACHAT_ARTICLE'] * $total_prx_qte['QUANTITY_ARTICLE'];
                              echo $to;
                             ?>
                          </td>
                          <td>
                                <?php 
                                 $prix_a = $this->db->query("SELECT SUM(PRIX_DACHAT_ARTICLE) AS PRIX_A FROM pos_store_1_ibi_articles WHERE CODEBAR_ARTICLE = '".$namer->REF_PRODUCT_CODEBAR."'  ")->row_array();
                                   echo $prix_a['PRIX_A']; 
                               ?>     
                          </td>
                          <td>
                            <?php 
                                 $prix_v = $this->db->query("SELECT SUM(PRIX_DE_VENTE_ARTICLE) AS PRIX_V FROM pos_store_1_ibi_articles WHERE CODEBAR_ARTICLE ='".$namer->REF_PRODUCT_CODEBAR."'  ")->row_array();
                                   echo $prix_v['PRIX_V']; 
                               ?>                             
                          </td>
                          <td> 
                             <?php $benefice = $prix_v['PRIX_V'] - $prix_a['PRIX_A'];

                                      if(is_null($prix_v['PRIX_V'])){
                                         echo"0";
                                      }
                                       else{
                                        echo $benefice;
                                       }
                                   ?> 
                                </td>
                            </tr>

                        <?php }?>            
                     </tbody>
                        
                     <tfoot>
                      <tr>
                        <th colspan="4"><h4>Total sommmes</h4></th>
                        <th>  <?= $somme_bs; ?></th>

                        <th> <h4> <?php echo $prix_de_achat_t;
                        ?> </h4>
                        </th>
                        <th><h4> <?php echo $prix_de_vente;?> </h4>
                        </th>

                      </tr>
                     </tfoot>
                     
                  </table>
                  </div>
               </div>
               <hr>
           
                                

            </div>
            <!--/box body -->
         </div>
         <!--/box -->
      </div>
   </div>
</section>
<!-- /.content -->

<!-- Page script -->
<script>
 function getCommanderDate() {
    let selecter_date = $('#selecter_date').val();

  let uri = <?php echo $this->uri->segment(2); ?>;


    $.ajax({
      url:BASE_URL +"rapports/<?php echo $this->uri->segment(2)?>/getcommandData",
      type:'post',
      dataType:'json',
      data:{selecter_date:selecter_date, "<?php echo $this->security->get_csrf_token_name(); ?>": "<?php echo $this->security->get_csrf_hash(); ?>"},
         success:function(datas){
        // alert(datas);
        console.log(datas)
        $('#id_table_one').html(datas.showAll);
      }

      
    })
    // alert(selecter_date);
 }




  $(document).on('click', '#btnprint', function(){
   // let data=$('#mytable').html();
   // $('.trdata').html(data);
   window.print();
  })

</script>

<style type="text/css">
 @media all {
.page-break { display: none; }
.trdata{ display: none; }
.header_title{display: none; text-align: center;}
}

@media print {
.page-break { display: block; page-break-before: always; }
 #form_trans{display: none;}
.trdata{display: block;}
.header_title{display: block; text-align: center;}
.main-footer{display: none;}

table tbody tr td{
  border: 1px solid #000 !important;
}



    .view-nav,.main-footer,#btn_print,.title,.btn, #myform, .widget-user-header{
      display: none !important;
    }
a {
      display: none !important;
    }
    .print{
      text-align: center !important; 
      background-color: #0002 !important;
    }

 
table td{
border:1px solid #000 !important;
    }
td{
border:1px solid #000 !important;
    }

 table tr th{
 border:1px solid black !important;
  
}
th{
  background-color: green !important;
}
 
img{
  margin-top: 15% !important;
 
}

   
.celldiv{
  background-color: #999 !important;
  }

}
</style>

<script type="text/javascript">
    $(".dateTimePickers").datetimepicker({
        maxDate: new Date(),
        maxDateTime:new Date().getTime(),
        format: "Y-m-d H:i:s",
        autoclose: true,
        todayBtn: true,
        startDate: "Y-m-d H:i:s",
        step: 1
    });
</script>