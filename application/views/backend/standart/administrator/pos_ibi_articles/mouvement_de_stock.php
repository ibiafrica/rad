<script src="<?= BASE_ASSET; ?>/js/jquery.hotkeys.js"></script>
<script type="text/javascript">
  //This page is a result of an autogenerated content made by running test.html with firefox.
  function domo() {

    // Binding keys
    $('*').bind('keydown', 'Ctrl+e', function assets() {
      $('#btn_edit').trigger('click');
      return false;
    });

    $('*').bind('keydown', 'Ctrl+x', function assets() {
      $('#btn_back').trigger('click');
      return false;
    });

  }


  jQuery(document).ready(domo);
</script>
<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Rapports de commandes  <small>  -- </small>
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
    <li class=""><a href="<?= site_url('administrator/articles'); ?>">Articles</a></li>
    <li class="active"><?= cclang('detail'); ?></li>
  </ol>
</section>
<!-- Main content -->
<section class="content">
  <div class="row">

    <div class="col-md-12">
      <div class="box box-warning">
        <div class="box-body ">

          <div class="box box-widget widget-user-2">


            <form class="form-horizontal" name="form_hospital_ibi_articles" id="form_hospital_ibi_articles" action="<?= base_url('rapports/'.$this->uri->segment(2).'/mouvement_de_stock'); ?>">


              <div class="widget-user-header ">
                <div class="row pull-center">
                  <div class="col-md-12 jumbotron" style="border-radius: 6px; height: 150px;">
                    <div class="col-lg-3 col-md-3 col-sm-3">
                      <div class="input-group">
                        <span class="input-group-addon">Du</span>
                        <input type="text"  class="form-control dateTimePickers" name="date_depart" value="<?= $date_depart ?>">
                      </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3">
                      <div class="input-group">
                        <span class="input-group-addon">Au</span>
                        <input type="text" class="form-control dateTimePickers" name="date_fin" value="<?= $date_fin ?>">
                      </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3">
                      <div class="input-group">
                        <span class="input-group-addon">Status</span>
                        <select type="text" class="form-control chosen chosen-select" name="categorie"  id="categorie" value="<?php set_value('categorie')?>">
                             <option value="" >Selectionner le type de paie</option>
                             <option value="0"> En Attente</option>
                             <option value="2"> Payer</option>
                             <option value="10">Crediter</option>
                             <option value="1"> En Avance</option>
                             <option value="11">Complementaire</option>

                       <!--   <?php
                                   foreach ($type_de_facture as $key) { ?>
                              <option value="<?php echo $key->ID_TYPE_FACTURE?>"> <?php echo $key->DESIGNATION_TYPE_FACTURE?></option>
                             <?php } ?> -->

                   
                        </select>
                      </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3">
                      <div class="btn-group btn-group-md">
                        <button type="submit" name="name" class="btn btn-default"><i class="fa fa-refresh"></i>
                        </button>
                        <button type="button" print-item=".content-wrapper" name="name" class="btn btn-default" onclick="printTable()">Imprimer
                      <!--     <i class="fa fa-print"></i> -->
                        </button>
                        <button type="button" name="name" class="btn btn-default" onclick="tableToExcel('headerTable', 'W3C Example Table')">
                          <i class="export glyphicon glyphicon-export"></i>
                        </button>
                      </div>
                    </div>
                   <br> <br>

                   <div class="row">
                      <div class="col-lg-6 col-md-3 col-sm-3">
                          <?php if(!empty($du) || !empty($au)){?>
                            <h4> Rapport de commandes  --  <span id="date_rapport"> du <?=$du ?> au <?=$au ?></span></h4>
                          <?php } else {?>  <h4>Rapports commande entiers.</h4> <?php }?>
                      </div>
                       
                       <div class="col-lg-3 col-md-3 col-sm-3">
                          <h4> Statut paie:       
                           <?php 
                             $st = $status;
                              if(!is_null($st)){
                                $status = $st;
                              if($status ==0){
                                echo "<i class='label bg-yellow'>En attente..</i>";
                                }
                              else if($status ==2){        
                                echo "<i class='label bg-green'>Payer</i>";
                                }
                               else if($status ==1){
                                echo "<i class='label bg-blue'>En Avance </i>";
                                }
                               else if($status ==10){
                                 echo "<i class='label bg-red'> En Credit </i>";
                                }
                               else if($status ==11){
                                echo "<i class='label bg-aqua'> Complementaire </i>";
                                }
                              else{
                               echo "<i class='label bg-black'> -statut non defini- </i>";
                                 }  } else{}?> </h4>
                       </div>
                      <div class="col-lg-3 col-md-3 col-sm-3">
                         <h4>Sommes total: <b> <?= $sommesCommande['total']; ?> </b></h4>
                      </div>
                   </div>


                  </div>
                </div>

              </div>
            </form>
            <div class="table-responsive">

              <div class="box">
              <!--   <div class="box-header with-border">mouvement de stock</div> -->
                <div class="box-body no-padding">
                  <table class="table table-bordered table-striped" id="headerTable">
                    <thead>
                      <tr>

                      <!-- <tr>
                        <th colspan="2" class="text-center">Article</th>
                         <th colspan="1" class="text-center">Stock initial</th>
                        <th colspan="2" class="text-center">Entrees</th>
                        <th colspan="2" class="text-center">Sorties</th>
                          <th colspan="2" class="text-center">Defectueux</th>
                            <th colspan="2" class="text-center">Suppression</th>
                        <th colspan="3" class="text-center">Stock restant</th>
                      </tr> -->

                      <tr>
                        <th class="text-center" width="">CODEBAR_CMD</th>
                        <!-- <th class="text-center" width="">TITRE_CMD </th> -->
                        <th class="text-center" width=""> TOTAL_Q_P </th>
                        <th class="text-center">CMD_CREER_PAR</th>
                        <th class="text-center">DATE_CREER_CMD</th>
                        <th class="text-center" hidden> STATUS_CMD</th>
                        <th class ="text-center"> Actions</th>
      
                    </thead>
                    <tbody>
                       <?php if (is_array($articles) || is_object($articles)){
                           foreach ($articles as $artic): ?>
                          <tr>
                            <td class="text-center"> <?php echo $artic->CODE?> </td>
                            <td class="text-center">
                                <?php  $TOTAL = $this->model_r_proforma->sumSommes('pos_ibi_commandes_produits',$artic->CODE);
                                   echo $TOTAL['sommes_by_cmd'];
                                ?>
                             </td>
                            <td class="text-center"> 
                               <?php $createBy = $this->model_r_proforma->one_bs('aauth_users',array('id'=>$artic->CREATED_BY_pos_IBI_COMMANDES));?>
                               <?php echo ($createBy['full_name']);?>
                             </td>
                            <td class="text-center"><?php echo $artic->DATE_CREATION_pos_IBI_COMMANDES;?></td>
                            <td class="text-center" hidden>     
          
                             </td>

                            <td>
                              <a title="ouvrir" style="margin-right: 2px" href="<?= site_url('rapports/view_detail_commande/'.
                               $artic->ID_pos_IBI_COMMANDES); ?>" id="<?php echo $artic->ID_pos_IBI_COMMANDES; ?>" onclick="bs_Viewer(this)"  class="btn btn-warning btn-xs">
                               <i class="fa fa-eye-slash"></i></a>

                              <a href="javascript:void(0)" type="button" class="btn btn-success btn-xs"> <i class="fa fa-edit"></i></a>
                              <a href="javascript:void(0)" type="button" class="btn btn-info btn-xs"> <i class="fa fa-flag"></i></a>
                            
                            </td>
                    

                          </tr>
                       <?php endforeach; }?>

                    </tbody>

                  </table>
                </div>
              </div>
              <!-- <div style="padding: 0 2rem;">
                <h5><b>Entrees:</b> </h5>
                <h5><?php echo "Approvisionnement."; ?></h5>


                <h5><b>Sorties: </b></h5>
                <h5><?php echo "Vente,retrait stock."; ?></h5>
              </div> -->
            </div>

          </div>
        </div>
        <!--/box body -->
      </div>
      <!--/box -->
    </div>
  </div>
</section>
<!-- /.content -->



<script type="text/javascript">
  var tableToExcel = (function() {
    var uri = 'data:application/vnd.ms-excel;base64,',
      template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',
      base64 = function(s) {
        return window.btoa(unescape(encodeURIComponent(s)))
      },
      format = function(s, c) {
        return s.replace(/{(\w+)}/g, function(m, p) {
          return c[p];
        })
      }
    return function(table, name) {
      if (!table.nodeType) table = document.getElementById(table)
      var ctx = {
        worksheet: name || 'Worksheet',
        table: table.innerHTML
      }
      window.location.href = uri + base64(format(template, ctx))
    }
  })()

  function printTable() {
    var divToPrint = document.getElementById("headerTable");
    newWin = window.open("");
    newWin.document.write(divToPrint.outerHTML);
    newWin.print();
    newWin.close();
  }
</script>
<!-- nturubika rothshild david -->


<script type="text/javascript">
    $(".dateTimePickers").datetimepicker({
        maxDate: new Date(),
        maxDateTime:new Date().getTime(),
        format: "Y-m-d H:i:s",
        autoclose: true,
        todayBtn: true,
        startDate: "Y-m-d H:i:s",
        step: 1
    });
</script>