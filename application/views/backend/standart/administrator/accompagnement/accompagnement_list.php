<script src="<?= BASE_ASSET; ?>/js/jquery.hotkeys.js"></script>

<script type="text/javascript">
   //This page is a result of an autogenerated content made by running test.html with firefox.
   function domo() {

      // Binding keys
      $('*').bind('keydown', 'Ctrl+a', function assets() {
         window.location.href = BASE_URL + '/administrator/requisition/add';
         return false;
      });

      $('*').bind('keydown', 'Ctrl+f', function assets() {
         $('#sbtn').trigger('click');
         return false;
      });

      $('*').bind('keydown', 'Ctrl+x', function assets() {
         $('#reset').trigger('click');
         return false;
      });

      $('*').bind('keydown', 'Ctrl+b', function assets() {

         $('#reset').trigger('click');
         return false;
      });
   }

   jQuery(document).ready(domo);
</script>
<!-- Content Header (Page header) -->
<section class="content-header">
   <h3>
     Accompagnement
   </h3>
   <h5 class="widget-user-desc">liste <i class="label bg-yellow"><?= $accompagnements_bs_counts; ?> accompagnements</i></h5>
   <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
      <li class="active">SunStone Accommpagnement</li>
   </ol>
</section>
<!-- Main content -->
<section class="content">
   <div class="row">

      <div class="col-md-12">
         <div class="box box-warning">
            <div class="box-body ">
               <!-- Widget: user widget style 1 -->
               <div class="box box-widget widget-user-2">
                  <!-- Add the bg color to the header using any of the bg-* classes -->
                  <form name="form_req" id="form_req" action="<?= base_url('accompagnement/' . $this->uri->segment(2) . '/index'); ?>">

                     <div class="widget-user-header" style="display: flex; justify-content: space-between;">

             

        


                        <div class="col-md-6">


                           <div class="row">
                              <div class="col-md-11">
                                 <input style="margin-right: 11px;" type="text" class="form-control" name="q" id="filter" placeholder="Rechercher" value="<?= $this->input->get('q'); ?>">
                              </div>
                              <div class="col-md-1">
                                 <button type="submit" class="btn btn-flat" name="sbtn" id="sbtn" value="Apply" title="Recherche.."><i class="fa fa-search"></i></button>
                              </div>
                           </div>
                        </div>



                    <div class="col-sm-2">
                           <div>
                              <?php is_allowed('req_add', function () { ?>
                                     <a class="btn btn-flat btn-success btn_add_new"  data-toggle="modal" data-target="#exampleModal" id="btn_add_new" title="ajout categorie  (Ctrl+a)" href="javascript:void(0)"><i class="fa fa-plus-circle" aria-hidden="true"></i> </a>

                              <?php }) ?>
                              <?php is_allowed('req_export', function () { ?>
                                 <a class="btn btn-flat btn-success" title="<?= cclang('export'); ?> Pos Ibi accompagnement" href="<?= site_url('administrator/accompagnement/export'); ?>"><i class="fa fa-file-excel-o"></i></a>
                              <?php }) ?>
                           </div>
                        </div>

                     </div>



                     <br>
                     <div class="table-responsive">
                        <table class="table table-bordered table-striped dataTable" id="table_accompagnement">
                           <thead>
                              <tr class="">
                             
                                 <th>No</th>
                                 <th>Designation accompagnement</th>
                                 <th>Creer par</th>
                                 <th>Date Creation</th>
                                 <th>Actions</th>

                              </tr>
                           </thead>
                           <tbody id="tbody_req">
                              <?php $n=0;foreach ($accompagnements_bs as $itms): $n++;?>
                              <tr>
                                  <td><?php echo $n;?></td>
                                  <td><?php echo $itms->DESIGNATION_ACCOMPAGNEMENT;?></td>
                                  <td> <?php echo get_name_user($itms->CREATE_BY_ACCOMPAGNEMENT);?> </td>
                                  <td> <?php echo $itms->DATE_CREATED;?> </td>

                                  <td>
                                     
                                     <a type="button" title="modification" onclick="get_accompagnement(this)"
                                       id="<?php echo $itms->ID_ACCOMPAGNEMENT; ?>"
                                       class="btn btn-info btn-xs get_mod" data-toggle="modal"
                                       data-target="#exampleModal_up"> <i class="fa fa-pencil-square-o"
                                          aria-hidden="true"></i> </a>

                                       

                                 <a type="button" title="suppression" onclick="deleteAcco(this)" id="<?php echo $itms->ID_ACCOMPAGNEMENT; ?>" class="btn btn-danger btn-xs get_mod" data-toggle="modal" data-target="#exampleModal_del"> <i class="fa fa-trash"
                                          aria-hidden="true"></i> </a>


                                  </td>

                                  
                                 
                              </tr>
                                 
                              <?php endforeach;?>
                              <tr></tr>
            
                           </tbody>
                        </table>
                     </div>
               </div>
               <hr>
               <!-- /.widget-user -->
               <div class="row">

                  </form>
                  <div class="col-md-4">
                     <div class="dataTables_paginate paging_simple_numbers pull-right" id="example2_paginate">
                        <?= $pagination; ?>
                     </div>
                  </div>
               </div>
            </div>
            <!--/box body -->
         </div>
         <!--/box -->
      </div>
   </div>
</section>
<!-- /.content -->

<!-- Page script -->
                         

                 



<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title add_title" id="exampleModalLabel">Ajout dUn Accompagnement</h5>

        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          

    <?= form_open('', [
                            'name'    => 'form_accompagnement', 
                            'class'   => 'form-horizontal', 
                            'id'      => 'form_accompagnement', 
                            'enctype' => 'multipart/form-data', 
                            'method'  => 'POST'
                            ]); ?>
                         
                         <div class="form-group ">
                            <label for="DESIGNATION_ACCOMPAGNEMENT" class="col-sm-3 control-label">Designation 
                            <i class="required">*</i>
                            </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="DESIGNATION_ACCOMPAGNEMENT" id="DESIGNATION_ACCOMPAGNEMENT" placeholder="Designation Accompagnement" value="">

                                <input type="hidden" class="form-control" name="ID_STORE" id="ID_STORE" placeholder="" value="<?php echo $this->uri->segment(2);?>">


                            </div>
                        </div>
                                                
                        <br>
                        <div class="message"></div>
                        <div class="row-fluid col-md-7">
                           <button class="btn btn-flat btn-info btn_save_s btn_action" id="btn_save" data-stype='stay' title="<?= cclang('save_button'); ?> (Ctrl+s)">
                            <i class="fa fa-check-circle" ></i> Enregistrez
                            </button>


                           

                            <a class="btn btn-flat btn-default btn_action" id="btn_cancel" data-dismiss="modal" title="Retour (Ctrl+x)">
                               <i class="fa fa-undo"></i> Retour
                            </a>
                            <span class="loading loading-hide">
                            <img src="<?= BASE_ASSET; ?>/img/loading-spin-primary.svg"> 
                            <i><?= cclang('loading_saving_data'); ?></i>
                            </span>
                        </div>
                        <?= form_close(); ?>


      </div>
      <div class="modal-footer">
      
      </div>
    </div>
  </div>
</div>






<div class="modal fade" id="exampleModal_up" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title add_title" id="exampleModalLabel">Modification</h5>

        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          

    <?= form_open('', [
                            'name'    => 'form_pos_accompagnement_ups', 
                            'class'   => 'form-horizontal', 
                            'id'      => 'form_pos_accompagnement_ups', 
                            'enctype' => 'multipart/form-data', 
                            'method'  => 'POST'
                            ]); ?>
                         
                         <div class="form-group ">
                            <label for="DESIGNATION_ACCOMPAGNEMENT_UP" class="col-sm-3 control-label">Designation 
                            <i class="required">*</i>
                            </label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" name="DESIGNATION_ACCOMPAGNEMENT_UP" id="DESIGNATION_ACCOMPAGNEMENT_UP" placeholder="Designation Accompagnement" value="">
                              <input type="hidden" name="ID_ACCOMPAGNEMENT_UP" id="ID_ACCOMPAGNEMENT_UP" value="">

                            </div>
                        </div>
                                                
                        <br>
                        <div class="message"></div>
                        <div class="row-fluid col-md-7">
                           <button class="btn btn-flat btn-info btn_edit_typ btn_action" id="btn_edit_typ" data-stype='stay' title="<?= cclang('save_button'); ?> (Ctrl+s)">
                            <i class="fa fa-save" ></i> Modifiez
                            </button>                           

                            <a class="btn btn-flat btn-default btn_action" id="btn_cancel" data-dismiss="modal" title="Retour (Ctrl+x)">
                               <i class="fa fa-undo"></i> Retour
                            </a>
                            <span class="loading loading-hide">
                            <img src="<?= BASE_ASSET; ?>/img/loading-spin-primary.svg"> 
                            <i><?= cclang('loading_saving_data'); ?></i>
                            </span>
                        </div>
                        <?= form_close(); ?>


      </div>
      <div class="modal-footer">
      
      </div>
    </div>
  </div>
</div>








<div class="modal fade" id="exampleModal_del" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
     
      <div class="modal-body">
         <div class="col-md-6">

            <input type="hidden" name="ID_ACCOMPAGNEMENT_DEL" id="ID_ACCOMPAGNEMENT_DEL" value="">
           <button class="btn btn-flat btn-danger delete_all_bas btn_action" id="delete_all_bas" data-stype='stay' title="suppression"> <i class="fa fa-trash" ></i> Confiration de la suppression</button>                           
         </div>

         <div class="col-md-6">
           <a class="btn btn-flat btn-default btn_action" id="btn_cancel" data-dismiss="modal" title="Retour">
             <i class="fa fa-undo"></i> Annulation de la suppression
          </a>
         </div>


         </div>
      <br>
      <br>
   
    </div>
  </div>
</div>









<!-- Page script -->
<script>
   $(document).ready(function() {})





      $(document).on('click','.btn_save_s',function(e){
         e.preventDefault();

        let designation = $('#DESIGNATION_ACCOMPAGNEMENT').val();
        if(designation==""){
         toastr['warning']('Donnee exiger!!');
         return false;
        }else{
           var form_accompagnement = $('#form_accompagnement');
           var data_post = form_accompagnement.serializeArray();
           var save_type = $(this).attr('data-stype');

           data_post.push({name: 'save_type', value: save_type});

           $('.loading').show();
       
           $.ajax({
             url: BASE_URL + '/administrator/accompagnement/add_save',
             type: 'POST',
             dataType: 'json',
             data: data_post,
             success:function(res){
               if(res==true) {
                  $('#table_accompagnement').load(' #table_accompagnement');
                  $('#exampleModal').modal('hide');
                  $('.message').css('display', 'none');
                  $('#DESIGNATION_ACCOMPAGNEMENT').val("");
                  toastr['success']('Accompagnement Ajouter');   
                  $('.loading').hide();
   
             } else {
                  toastr['warning']('Erreur dAjour lAccompagnement');   
             }
             }
           })
           


        }


            
      }); /*end btn save*/
      
       

   $(document).on('click','#btn_cancel',function() {
      $('#DESIGNATION_ACCOMPAGNEMENT').val("");
                        $('.loading').hide();

   })




</script>



<script type="text/javascript">
   
   function get_accompagnement(th){
      
  let id = $(th).attr('id');

      $.ajax({
         url: BASE_URL + '/administrator/accompagnement/get_accompagnement',
         type: 'POST',
         dataType: 'json',
         data: {
            id: id
         },
         success: function(dt) {
            console.log(dt);
            $("#ID_ACCOMPAGNEMENT_UP").val(dt.ID_ACCOMPAGNEMENT);
            $("#DESIGNATION_ACCOMPAGNEMENT_UP").val(dt.DESIGNATION_ACCOMPAGNEMENT);

         }
      })
   }








   $(document).on('click','.btn_edit_typ',function(e) {
      e.preventDefault();
      $('.message').fadeOut();
            let designation = $('#DESIGNATION_ACCOMPAGNEMENT_UP').val();

      if(designation==""){
         toastr['warning']('Designation exiger!!..');
         return false;
      }

      var form_pos_accompagnement_ups = $('#form_pos_accompagnement_ups');
      var data_post = form_pos_accompagnement_ups.serializeArray();
      var save_type = $(this).attr('data-stype');
      let id = $('#ID_ACCOMPAGNEMENT_UP').val();

      data_post.push({
         name: 'save_type',
         value: save_type
      });
      $('.loading').show();

      $.ajax({
            url: BASE_URL + '/administrator/accompagnement/edit_save/' + id,
            type: 'POST',
            dataType: 'json',
            data: data_post,
            success:function(data){
               if(data==true){

                  $('#table_accompagnement').load(' #table_accompagnement');
                  $('#exampleModal_up').modal('hide');
                  $('.message').css('display', 'none');
                  $('#DESIGNATION_ACCOMPAGNEMENT').val("");
                  toastr['success']('Accompagnement Modifier');   
                  $('.loading').hide();
               }else{toastr['warning']('Erreur de la Modification');}
            }
         })
           
       
        
   }); /*end btn save*/




</script>



<script type="text/javascript">
   
   function deleteAcco(th){
      let id =$(th).attr('id');
      $('#ID_ACCOMPAGNEMENT_DEL').val(id);
   }



   $(document).on('click','#delete_all_bas',function(){
      let id_deleted = $('#ID_ACCOMPAGNEMENT_DEL').val();


         $.ajax({
            url: BASE_URL + '/administrator/accompagnement/delete_accompagnement',
            type: 'POST',
            dataType: 'json',
            data: {id_deleted:id_deleted},
            success:function(data){
               if(data==true){

                  $('#table_accompagnement').load(' #table_accompagnement');
                  $('#exampleModal_del').modal('hide');
                  $('.message').css('display', 'none');
                  $('#DESIGNATION_ACCOMPAGNEMENT').val("");
                  toastr['success']('Accompagnement Supprimer');   
                  $('.loading').hide();
               }else{toastr['warning']('Erreur de la Suppression');}
            }
         })

   })
</script>
