

<script src="<?= BASE_ASSET; ?>/js/jquery.hotkeys.js"></script>

<script type="text/javascript">

//This page is a result of an autogenerated content made by running test.html with firefox.

function domo(){

 

   // Binding keys

   $('*').bind('keydown', 'Ctrl+e', function assets() {

      $('#btn_edit').trigger('click');

       return false;

   });



   $('*').bind('keydown', 'Ctrl+x', function assets() {

      $('#btn_back').trigger('click');

       return false;

   });

    

}





jQuery(document).ready(domo);

</script>

<!-- Content Header (Page header) -->

<section class="content-header">

   <h1>

      Information Clients      <small> </small>

   </h1>

   <ol class="breadcrumb">

      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>

      <li class=""><a  href="<?= site_url('administrator/pos_clients'); ?>">Information Clients</a></li>

      <li class="active"><?= cclang('detail'); ?></li>

   </ol>

</section>

<!-- Main content -->

<section class="content">

   <div class="row" >

     

      <div class="col-md-12">

         <div class="box box-warning">

            <div class="box-body ">



               <!-- Widget: user widget style 1 -->

               <div class="box box-widget widget-user-2">

                  <!-- Add the bg color to the header using any of the bg-* classes -->

                  <div class="widget-user-header ">

                    

                     <div class="widget-user-image">

                        <img class="img-circle" src="<?= BASE_ASSET; ?>/img/view.png" alt="User Avatar">

                     </div>

                     <!-- /.widget-user-image -->

                     <h3 class="widget-user-username">Information Clients</h3>

                     <h5 class="widget-user-desc"></h5>

                     <hr>

                  </div>







<ul class="nav nav-tabs">

  <li class="nav-item">

    <a class="nav-link active" data-toggle="tab" href="#home" style="font-weight: bold;"><i class="fa fa-map-signs" aria-hidden="true"></i> Identification client</a>

  </li>

  <li class="nav-item">

    <a class="nav-link" data-toggle="tab" href="#menu1" style="font-weight: bold;"><i class="fa fa-signal" aria-hidden="true"></i> Factures client</a>

  </li>

  <li class="nav-item">

    <a class="nav-link" data-toggle="tab" href="#menu2" style="font-weight: bold;"><i class="fa fa-bar-chart" aria-hidden="true"></i> Statistique client</a>

  </li>



  <li class="nav-item">

    <a class="nav-link active" data-toggle="tab" href="#situation" style="font-weight: bold;"><i class="fa fa-money" aria-hidden="true"></i> Situation Financière</a>

  </li>



</ul>



<!-- Tab panes -->

<div class="tab-content">



  <!-- debut information client -->



  <div class="tab-pane container active" id="home" style="margin-left:-10px; ">

      <!-- <hr> -->

        <br>

    

                  <div class="form-horizontal" name="form_pos_clients" id="form_pos_clients" >

                   

                     <div class="row card">

                       <div class="col-xs-12 col-md-5 col-lg-5">

                          <div class="card text-center">

                            <img src="<?php echo base_url('uploads/user_image/'.$pos_clients->DOCUMENT_FILE_IDENTITE)?>" data-toggle="modal" data-target="#myModal" width="80%" height="80%" style="width: 40%; height: 30%; border-radius:50%; ">





                        



                              <div id="myModal" class="modal fade" tabindex="-1" role="dialog">

                                <div class="modal-dialog">

                                  <div class="modal-content">

                                    

                                      <div class="modal-body">

                                       <img src="<?php echo base_url('uploads/user_image/'.$pos_clients->DOCUMENT_FILE_IDENTITE)?>" data-toggle="modal" data-target="#myModal" width="80%" height="80%" style="width: 60%; height: 30%; border-radius:5px; ">                   

                                       </div>



                                      <div class="modal-footer">

                                         <button type="button" class="btn btn-danger" data-dismiss="modal" aria-label="Close">  Fermeture <i class="fa fa-times-circle"></i>

                                        </button>

                                      </div>

                                  </div>

                                </div>

                              </div>



                          </div>



                          <div class="jumbotron">

                                   <?= _ent($pos_clients->DESCRIPTION_CLIENT); ?>

                          </div>

                       </div>

                       



                       <div class="col-xs-12 col-md-7 col-lg-7">

                            <div class="form-group ">

                                <label for="content" class="col-sm-3 control-label">Nom </label>



                                <div class="col-sm-8">

                                   <?= _ent($pos_clients->NOM_CLIENT); ?>

                                </div>

                            </div>

                                                 

                            <div class="form-group ">

                                <label for="content" class="col-sm-3 control-label">Prenom </label>



                                <div class="col-sm-8">

                                   <?= _ent($pos_clients->PRENOM); ?>

                                </div>

                            </div>

                                                 

                            <div class="form-group ">

                                <label for="content" class="col-sm-3 control-label">Type D'identité </label>



                                <div class="col-sm-8">

                                   <?php $id_ty =$pos_clients->TYPE_IDENTITE;

                                         if($id_ty ==1){

                                          echo "PASSEPORT";

                                         }

                                         elseif($id_ty ==2){

                                           echo "CARTE NATIONALE";

                                         }

                                         else{

                                          echo "AUTRES";

                                         }

                                    ?>

                                </div>

                            </div>



                             <div class="form-group ">

                                <label for="content" class="col-sm-3 control-label">Num d'identité </label>



                                <div class="col-sm-8">

                                   <?= _ent($pos_clients->NUM_IDENTITE); ?>

                                </div>

                            </div>



                                                 

                                                 

                            <div class="form-group ">

                                <label for="content" class="col-sm-3 control-label">Téléphone </label>



                                <div class="col-sm-8">

                                   <?= _ent($pos_clients->TEL_CLIENTS); ?>

                                </div>

                            </div>

                        
                          <div class="form-group ">

                                <label for="content" class="col-sm-3 control-label">NIF Client </label>



                                <div class="col-sm-8">

                                   <?= _ent($pos_clients->NIF_CLIENT); ?>

                                </div>

                            </div>

                                                 

                            <div class="form-group ">

                                <label for="content" class="col-sm-3 control-label">Date Creation </label>



                                <div class="col-sm-8">

                                   <?= _ent($pos_clients->DATE_CREATION_CLIENT); ?>

                                </div>

                            </div>

                                                 

                            <div class="form-group ">

                                <label for="content" class="col-sm-3 control-label">Créer Par </label>



                                <div class="col-sm-8">

                                   <?php echo get_name_user($pos_clients->CREATED_BY_CLIENT); ?>

                                </div>

                            </div>

                                                

                            <br>

                            <br>

                            



                            <div class="view-nav text-center" >

                                <?php is_allowed('pos_clients_update', function() use ($pos_clients){?>

                               

                                <?php }) ?>

                                <a class="btn btn-flat btn-primary btn_action" id="btn_back" title="back (Ctrl+x)" href="<?= site_url('administrator/pos_clients/'); ?>"><i class="fa fa-undo" ></i> Retour</a>

                             </div>

                       </div>

                     </div>

                    

                  </div>

      </div>



  <!-- fin formation client -->





 <!-- debut facturation -->

    <div class="tab-pane container fade" id="menu1" style="margin-left:-30px; ">

      <br/>

       <div class="container">

        <div class="row">

            

        <div class="col-md-12">

       <div class="table-responsive">



        <table class="col-md-12 table table-responsive table-bordered table-hover" id="table_cmd">

                <thead>

                  <tr class="">

                    <th width="30">

                      No

                    </th>

                    <th width="100">Facture</th>

                    <th width="100">Montant a payé</th>

                    <th width="100">Montant payé</th>

                    <th width="70">Status facture</th>

                    <th width="100">Facture Crée</th>

                    <th width="50">Action</th>

                  </tr>

                </thead>





                <tbody>



                    <?php $nbre=0; foreach ($paiement_client as $facture): $nbre++; 



                   $get_cmd = $this->db->query("SELECT * FROM pos_ibi_commandes_produits  WHERE  POS_IBI_COMMANDES_ID = ".$facture->ID_POS_IBI_COMMANDES." ")->result();

                    $total=0;

                    $sommation=0;

                       foreach($get_cmd as $paie){

                          $sommation=$paie->PRIX_VENDU*$paie->QUANTITE;

                         $total+=$sommation;

                       }

                    ?>

                      <tr>

                          <td> <?= $nbre;?></td>

                          <td width="100"><?= $facture->CODE; ?></td>

                          <td width="100"> <?= number_format($total);?> </td>

                        <td width="100">

                          <?php echo number_format($this->db->query('SELECT SUM(MONTANT_PAIEMENT) AS MONTANT FROM pos_paiements WHERE COMMANDE_ID ='.$facture->ID_POS_IBI_COMMANDES.'  ')->row_array()['MONTANT']);?> 

                       </td>

                        <td> <?php 



                             switch ($facture->COMMANDE_STATUS) {

                               case 0:echo "<i class ='label bg-orange'>En attente <i/>";break;

                               case 10:echo "<i class ='label bg-red'>Credit <i/>";break;

                               case 11:echo "<i class ='label bg-blue'>Complementaire <i/>";break;

                               case 1:echo "<i class ='label bg-yellow'>Avancer <i/>";break;

                               case 2:echo "<i class ='label bg-green'> Payer <i/>"; break;

                               default: echo "<i class ='label bg-black'> Autres <i/>"; break;

                           }

                          ?>

                       </td>

                       <td> <?= $this->db->get_where('aauth_users',array('id'=>$facture->CREATED_BY_POS_IBI_COMMANDES))->row_array()['full_name'];?>

                       </td>

                       <td>



                <!-- Button trigger modal -->

                    <a href="javascript:void(0)" type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#exampleModal<?php echo $facture->ID_POS_IBI_COMMANDES;?>">

                      <i class="fa fa-info-circle"></i>

                    </a>



                    <!-- Modal -->

                    <div class="modal fade" id="exampleModal<?php echo $facture->ID_POS_IBI_COMMANDES;?>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">

                      <div class="modal-dialog" role="document">

                        <div class="modal-content">

                          <div class="modal-header">

                            <h5 class="modal-title" id="exampleModalLabel">Detail facture</h5>

                       

                          </div>

                          <div class="modal-body">

                            <table class="table table-striped table-bordered table-hover">

                              <thead>

                                <th>Designation</th>

                                <th>Quantite</th>

                                <th>Montant</th>

                                <th>Status</th>

                                <th>Creer par</th>

                                <th>Date </th>

                              </thead>



                              <tbody>

                                <?php 

                                  foreach ($get_cmd as $cmd): ?>

                                    <tr>

                                      <td> <?php echo $cmd->NAME_PRODUIT;?></td>

                                      <td> <?php echo number_format($cmd->QUANTITE); ?> </td>

                                      <td> <?php echo number_format($cmd->QUANTITE*$cmd->PRIX_VENDU); ?></td>

                                      <td> <?php 

                                    if ($cmd->POS_IBI_COMMANDES_ID !=0){



                                        $status_cmd = $this->db->query("SELECT COMMANDE_STATUS FROM pos_ibi_commandes WHERE ID_POS_IBI_COMMANDES = ".$cmd->POS_IBI_COMMANDES_ID." ")->row_array(); 

                                           switch ($status_cmd['COMMANDE_STATUS']) {

                                        case 0:echo "<i class ='label bg-orange'> En attente</i>";break;

                                        case 2:echo "<i class ='label bg-success'>Payer</i>";break;

                                        case 1:echo "<i class ='label bg-blue'> En avance</i>";break;

                                        case 10:echo "<i class ='label bg-red'> En credit</i>";break;

                                        case 10:echo "<i class ='label bg-yellow'> complementaire</i>";break;

                                             default:

                                        echo "<i class ='label bg-black'> autre</i>";break;

                                           }

                                         }else{echo "";}

                                       ?> 

                                      </td>

                                      <td> 

                                        <?php if(is_null($cmd->CREATED_BY_POS_IBI_COMMANDES_PRODUITS)){ echo"";}else{echo $this->db->query("SELECT full_name FROM aauth_users WHERE id = ".$cmd->CREATED_BY_POS_IBI_COMMANDES_PRODUITS." ")->row_array()['full_name'];}?>

                                      </td>

                                      <td> <?php echo $cmd->DATE_CREATION_POS_IBI_COMMANDES_PRODUITS;?></td>



                                    </tr>

                                 <?php endforeach;

                                ?>

                              </tbody>

                            </table>

                            

                          </div>

                          <div class="modal-footer">

                            <button type="button" class="btn btn-success" data-dismiss="modal">Fermer</button>

                          </div>

                        </div>

                      </div>

                    </div>

                         



                           

                       </td>

                      </tr>  

                    <?php endforeach; ?>

                </tbody>



              </table>

          </div>

        </div>

      </div>

 </div>



    </div>

  <!-- fin facturation -->





  <div class="tab-pane container fade" id="menu2" style="margin-left:-30px; ">

    



<section class="content">

   <div class="row">



      <div class="col-md-12">





         <div class="box box-warning">



          <div class="box-body chart-responsive">

               <div class="chart" id="pos_stat" style="height: 300px; position: relative;"></div>

            </div>



         </div>



           <div class="box box-warning">



          <div class="box-body chart-responsive">

               <div class="chart" id="bar_stat" style="height: 300px; position: relative;"></div>

            </div>



           <div class="box box-warning">



          <div class="box-body chart-responsive">

               <div class="chart" id="pos_divers" style="height: 300px; position: relative;"></div>

            </div>



         </div>



         </div>

     </div>



</div>

</section>





  </div>





          <div class="tab-pane container fade" id="situation" >

            



          <section  style="padding-top: 50px;">





                   <div class="row">



                    <div class="col-md-12">



                    <div class="col-md-4">



                         <ul class="list-group">

                          <li class="list-group-item"><i>Montant du: </i> <b class="pull-right"> <?=$situation_client[0]['MONTANT_DU']?></b></li>

                          <li class="list-group-item"><i>Montant Payé </i>  <b class="pull-right"> <?=$situation_client[0]['MONTANT_PAID']?> </b></li>

                          <li class="list-group-item"><i>Reste: </i>  <b class="pull-right"> <?=$situation_client[0]['MONTANT_DU']-$situation_client[0]['MONTANT_PAID']?> </b></li>

                        </ul>

                    </div>



                    <div class="col-md-8">

                        <i style="font-weight: bold;">Historique de paiement</i>

                        <table style="width:100%" class="table table-bordered  table-condensed">

                            <tr>

                                <th>DATE</th>

                                <th>RECU PAR</th>

                                <th>MEDIA</th>

                                <th>MONTANT</th>

                            </tr>

                            <?php  foreach($situation_client[0]['HISTORY'] as $h): ?>

                                <tr>

                                    <td><?=$h['DATE']?></td>

                                    <td><?=$h['RECU_PAR']?></td>

                                    <td><?=$h['METHODE']?></td>

                                    <td><?=$h['AMOUNT']?></td>

                                </tr>

                            <?php endforeach ?>

                        </table>

                      </div>

                       

                   </div>

                </div>

                 

        </section>

          </div>



 </div>







                 

               </div>

            </div>

            <!--/box body -->

         </div>

         <!--/box -->



      </div>

   </div>

</section>

<!-- /.content -->







                <script src="https://code.highcharts.com/highcharts.js"></script>

                <script src="https://code.highcharts.com/modules/variable-pie.js"></script>

                <script src="https://code.highcharts.com/modules/exporting.js"></script>

                <script src="https://code.highcharts.com/modules/export-data.js"></script>

                <script src="https://code.highcharts.com/modules/accessibility.js"></script>







<script type="text/javascript">

  







Highcharts.chart('pos_stat', {

 chart: {

        type: 'column'

    },

    title: {

        text: 'Service Pos'

    },

    subtitle: {

        text: 'Les produits le plus commandee'

    },

    accessibility: {

        announceNewData: {

            enabled: true

        }

    },

    xAxis: {

        type: 'category'

    },

    yAxis: {

        title: {

            text: 'Fois(Demandé)'

        }



    },

    legend: {

        enabled: false

    },

    plotOptions: {

        series: {

            borderWidth: 0,

            dataLabels: {

                enabled: true,

                format: '{point.y:f}'

            }

        }

    },



    tooltip: {

        headerFormat: '<span style="font-size:11px">{series.name}</span><br>',

        pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:f} (fois)</b><br/>'

    },



    series: [

        {

            name: "Plat de",

            colorByPoint: true,

            data: [ <?php echo $top_ten_Pos;?> ]

        }

    ],

    drilldown: {

        series: [



        ]

    }

});





Highcharts.chart('bar_stat', {

 chart: {

        type: 'column'

    },

    title: {

        text: 'Service du Bar'

    },

    subtitle: {

        text: 'Les produits le plus commandee'

    },

    accessibility: {

        announceNewData: {

            enabled: true

        }

    },

    xAxis: {

        type: 'category'

    },

    yAxis: {

        title: {

            text: 'Fois(Demandé)'

        }



    },

    legend: {

        enabled: false

    },

    plotOptions: {

        series: {

            borderWidth: 0,

            dataLabels: {

                enabled: true,

                format: '{point.y:f}'

            }

        }

    },



    tooltip: {

        headerFormat: '<span style="font-size:11px">{series.name}</span><br>',

        pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:f}</b> of tbr/>'

    },



    series: [

        {

            name: "Service",

            colorByPoint: true,

            data: [ <?php echo $top_ten_bar;?>]

        }

    ],

    drilldown: {

        series: [

          

        ]

    }

});





Highcharts.chart('pos_divers', {

 chart: {

        type: 'column'

    },

    title: {

        text: 'Service divers'

    },

    subtitle: {

        text: 'Les services le plus rendu'

    },

    accessibility: {

        announceNewData: {

            enabled: true

        }

    },

    xAxis: {

        type: 'category'

    },

    yAxis: {

        title: {

            text: 'Fois(Demandé)'

        }



    },

    legend: {

        enabled: false

    },

    plotOptions: {

        series: {

            borderWidth: 0,

            dataLabels: {

                enabled: true,

                format: '{point.y:f}'

            }

        }

    },



    tooltip: {

        headerFormat: '<span style="font-size:11px">{series.name}</span><br>',

        pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:f}(fois)</b><br/>'

    },



    series: [

        {

            name: "Produit",

            colorByPoint: true,

            data: [ <?php echo $top_ten_divers;?> ]

        }

    ],

    drilldown: {

        series: [

          

        ]

    }

});



</script>